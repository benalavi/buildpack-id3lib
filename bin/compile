#!/usr/bin/env bash

BUILD_DIR=$1
CACHE_DIR=$2
TARGET_DIR="$BUILD_DIR/id3lib-3.8.3"

echo "-----> Using id3lib buildpack ($BUILD_DIR) ($CACHE_DIR)"

mkdir -p $TARGET_DIR
cd $TARGET_DIR

set -o pipefail; curl --fail --retry 3 --retry-delay 1 --connect-timeout 3 --max-time 20 https://s3.amazonaws.com/buildpack-id3lib/id3lib-3.8.3.tgz -o - | tar zxf -

cp -R $TARGET_DIR $CACHE_DIR

cd $BUILD_DIR

export C_INCLUDE_PATH=$C_INCLUDE_PATH:$TARGET_DIR/include

echo "-----> id3lib available at ${CACHE_DIR}/lib"
